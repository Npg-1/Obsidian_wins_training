# 쿠키 #
클라이언트의 IP 주소와 User-Agent는 매번 변경될 수 있는 고유하지 않은 정보일 뿐만 아니라, HTTP 프로토콜의 **Connecitonless**와 **Stateless** 특징 때문에 ==웹 서버는 클라이언트를 기억할 수 없음==

### HTTP 프로토콜 특징 ###
- **Connectionless**: *하나의 요청에 하나의 응답을 한 후 연결을 종료하는 것을 의미함*. 특정 요청에 대한 연결은 이후 요청과 이어지지 않고 새 요청이 있을 때마다 항상 새로운 연결을 맺음
- **Stateless**: *통신이 끝난 후 상태 정보를 저장하지 않는 것을 의미함*. 이전 연결에서 사용한 데이터를 다른 연결에서 요구할 수 없음

Connectionless, Stateless 특성을 갖는 HTTP에서 상태를 유지하기 위해 쿠키(Cookie)가 생김. 쿠키는 Key와 Value로 이뤄진 일종의 단위로, 서버가 클라이언트에게 쿠키를 발급하면, 클라이언트는 서버에 요청을 보낼 때마다 쿠키를 같이 전송함. 서버는 클라이언트의 요청에 포함된 쿠키를 확인해 클라이언트를 구분할 수 있음


## 용도 ##
일반적으로 쿠키는 클라이언트의 정보 기록과 상태 정보를 표현하는 용도로 사용함

### 정보기록 ###
웹 서비스 사용 시 종종 등장하는 팝업 창에 "다시 보지 않기", "7일 간 표시하지 않기" 버튼을 확인할 수 있는데 웹 서버는 각 클라이언트의 팝업 옵션을 기억하기 위해 쿠키에 해당 정보를 기록하고, 쿠키를 통해 팝업 창 표시 여부를 판단함. 과거에는 클라이언트의 정보를 저장하기 위해 쿠키가 종종 사용됐음. 쿠키는 서버와 통신할 때마다 전송되기 때문에 쿠키가 필요 없는 요청을 보낼 때 리소스 낭비가 발생할 수 있음. 최근에는 이러한 단점을 보완하기 위해 Modern Storage APIs를 통해 데이터를 저장하는 방식을 권장함


### 상태정보 ###
많은 웹 사이트에서는 회원 가입과 로그인을 통해 개개인에게 맞춤형 서비스를 제공합니다. 웹 서버에서는 수많은 클라이언트의 로그인 상태와 이용자를 구별해야 하는데, 이때 클라이언트를 식별할 수 있는 값을 쿠키에 저장해 사용합니다.



---
# 쿠키가 없는 통신과 있는 통신 #

![[Pasted image 20260121131921.png]]
위 그림은 쿠키가 없을 때의 통신으로, 서버는 클라이언트를 기억할 수 없어서 누군지 알 수 없기 때문에 어떤 클라이언트와 통신하는지 알 수 없음


![[Pasted image 20260121132006.png]]

위 그림은 쿠키가 있을 때의 통신으로, 클라이언트는 서버에 요청을 보낼 때마다 자신을 식별할 수 있는 쿠키를 포함해서 보내고, 서버는 해당 쿠키를 통해 자신이 통신하고 있는 클라이언트가 무엇인지 식별할 수 있음



---
# 쿠키 변조 #

클라이언트가 보내는 쿠키를 별다른 검증없이 서버가 식별한다면 쿠키 변조에 의한 정보 탈취 위험이 있음. 예를 들자면
어떤 중국집이 있는데 여기서 탕수육 쿠폰이 있어서 손님이 방문할 때 마다 도장을 쿠폰에 찍어줌. 도장은 식당에서 찍어주지만 쿠폰은 손님이 보관하게 됨. 이러면 악의를 가진 손님이 식당에서 쓰는 도장과 비슷한 도장을 구해서 쿠폰에 가짜 도장을 찍어서 악용할 수도 있음

쿠키는 클라이언트의 브라우저에 저장되고 요청에 포함되는 정보임. 따라서 아래 그림처럼 별다른 쿠키 검증 절차가 없다면 쿠키 정보를 변조해 서버에 요청을 보내서 타 이용자를 사칭해서 정보를 탈취할 위험이 있음

![[Pasted image 20260121141927.png]]



---
# 세션 #

위의 쿠키 변조에서 발생하는 문제의 근본적인 이유는 쿠폰을 손님이 가지고 있기 때문에 발생하는 문제임. 그래서 중국집에서 이러한 문제를 인지하고 손님들한테 도장을 찍어서 주는 게 아니라 무작위 문자열이 적힌 쿠폰을 나눠줌. 이후 손님이 쿠폰을 식당에 제시하면 식당에 보관 중인 메모장에 쿠폰에 적힌 문자열과 방문 횟수를 기록하는 식으로 하니까 해결! 이를 통해서 손님은 쿠폰에 적힌 랜덤한 문자열을 조작할 수 있지만 매장에 기록된 방문 횟수는 조작할 수 없게됨

웹 통신 시나리오 또한 중국집 식당의 예시와 비슷함. 웹 통신에서도 클라이언트가 쿠키를 변조해 서버에 요청을 보낼 수 있음. 따라서, 쿠키에 인증 상태를 저장하지만 클라이언트가 인증 정보를 변조할 수 없게 하기 위해 **세션(Session)** 을 사용함. 세션은 인증 정보를 서버에 저장하고 해당 데이터에 접근할 수 있는 **키(유추할 수 없는 랜덤한 문자열)** 를 만들어 클라이언트에 전달하는 방식으로 작동함. 해당 키를 일반적으로 **Session ID** 라고 함. 브라우저는 해당 키를 쿠키에 저장하고 이후에 HTTP 요청을 보낼 때 사용함. 서버는 요청에 포함된 키에 해당하는 데이터를 가져와 인증 상태를 확인함


![[Pasted image 20260121143108.png]]



---
# 연습: 드림핵 세션 #
![[Pasted image 20260121173617.png]]

![[Pasted image 20260121173630.png]]

![[Pasted image 20260121173639.png]]

![[Pasted image 20260121173653.png]]

쿠키에는 클라이언트의 세션 정보가 저장되어 있고, 서버는 이를 통해 사용자를 식별하고 인증을 처리함. 공격자가 사용자의 쿠키를 훔칠 수 있으면 세션에 해당하는 사용자의 인증 상태를 훔칠 수 있는데, 이를 **세션 하이재킹(Session Hijacking)** 이라고함



---
## 키워드 ##
- ### Connectionless ###
	- 하나의 요청에 하나의 응답을 한 후 연결을 종료하는 것을 의미합니다.
- ### Stateless ###
	- 통신이 끝난 후 상태 정보를 저장하지 않는 것을 의미합니다.
- ### 쿠키(Cookie) ###
	- HTTP에서 상태를 유지하기 위해 사용하는 Key-Value 형태의 값
- ### 세션(Session) ###
	- 쿠키에 포함된 Session ID를 사용해 서버에 저장된 세션 데이터에 접근하는 방식
- ### 세션 하이재킹(Session Hijacking) ###
	- 타 사용자의 쿠키를 훔쳐 인증 정보를 획득하는 공격


