# 1. 개요 #

## NMS란 ##
- NMS는 Network Management System 의 약어로 컴퓨터 네트워크 또는 네트워크들을 모니터링하고 관리하는데 사용되는 하드웨어와 소프트웨어의 조합을 총칭


## NMS의 기능과 역할 ##
- 네트워크 및 보안 장비, 서버, 서비스 등의 리소스 또는 트래픽 관리 및 Health Check
- 일반적으로 SNMP, SYSLOG 등으로 연동하거나, 자체 Agent 설치 후 중앙에서 모니터링
- 보안 장비 및 관제 대상의 상태를 관리할 때 총괄적으로 확인 가능
	- -> CPU, Memory, Disk, Traffic 등 서비스나 장비에 문제가 생겼을 때, 이에 대한 알람을 보내주는 시스템


## NMS 종류 ##
![[Pasted image 20260202091454.png]]





---
# 2. SNMP와 통신 흐름 #
## SNMP 란 ##
- SNMP는 Simple Network Management Protocol의 약어로 IP 네트워크 상의 장치로부터 정보를 수집 및 관리하며, 또한 정보를 수정하여 장치의 동작을 변경하는 데에 사용되는 인터넷 표준 프로토콜
- SNMP를 통해 보안 장비에 대한 데이터를 NMS에 연동하여 데이터를 수집하고 관리할 수 있음
- 일반적으로 네트워크 장비(보안 장비)의 모니터링은 자체 장비의 기능으로써 존재하는 SNMP를 통해 NMS에 연동하고, 서버의 모니터링은 NMS에서 제공하는 별도 Agent 설치를 통해 연동
- ### SNMP는 프로토콜임!! ###


## SNMP 버전 ##
1) SNMPv1 - SNMP의 최초 버전으로, 보안에 취약하고 데이터의 대량 수집 요청이 불가능
2) SNMPv2 - 데이터 대량 수집 요청이 추가되고, 인증에 대한 값이 암호화되어 보안성이 높아짐
3) **SNMPv2c - SNMPv2가 암호화로 인해 사용이 복잡해지는 문제점으로 평문으로 원복된 버전**
4) SNMPv3 - 다른 인증 요소를 추가하여 보안 기능을 강화


## SNMP 구성 ##

#### 1) MIB (Management Information Base) ####
- SNMP를 통해 네트워크를 관리할 때 관리되어야할 특정한 정보나 자원을 객체라고 하며, 그 객체들을 모아놓은 **집합체**
	- -> CPU, Memory, Interface 등을 나타내는 명칭의 모음
![[Pasted image 20260202093635.png]]

#### 2) OID (Object ID) ####
- 객체 아이디
- CPU, Memory, Interface 등을 나타내는 숫자 값

※ 이 값이 좀 중요한 게 단순히 **객체의 아이디**를 뜻하는 게 아님 단순한 id값이라면 1613617546 와 같이 숫자들의 배열로 되겠지만
숫자들 중간에 .이 붙어서 계층을 나타내게됨 실제로 인바운드 트래픽(수신 바이트 수)를 뜻하는 1.3.6.1.2.1.31.1.1.1.6를 쪼개면
![[Pasted image 20260203103600.png]]
이렇게 됨 그래서 OID값은 단순한 id값이 아니라 주소 체계인데 추가로 객체의 id값을 나타낸다고 보면 됨
![[Pasted image 20260202092212.png]]

#### 3) Community String ####
- 통신상에서 일종의 Password 역할을 하는 문자열을 의미
- SNMP Manager(NMS)와 SNMP Agent(보안 장비)가 서로 동일한 Community String을 가지고 있어야 통신이 성립됨
	- -> 진짜로 살짝 비밀번호 같은 느낌임 이게 두 장비가 서로 같지 않으면 Communication이 안 됨(그래서 Community String인가? 두둥탁!)
![[Pasted image 20260203102937.png]]


## SNMP 종류 ##

#### 1) GET 방식 ####
- Polling 방식이라고도 함
- Manager가 Agent에게 정보를 요청하면 응답해주는 방식으로 Agent가 161/udp 포트를 사용
- 아래 그림에서는 Network Device가 매니저고, Monitoring Server가 Agent인 거 같고 실습환경에서는 Zabbix 서버가 Manager이고, 방화벽이 Agent여서 Zabbix가 방화벽에 정보를 요청해서 해당 정보를 방화벽이 응답으로 넘겨줌
![[Pasted image 20260202095957.png]]

#### 2) TRAP 방식 ####
- Event Reporting 방식이라고도 함
- Agent가 이벤트 발생 시 이를 Manager에게 알리는 방식으로 Manager가 162/udp 포트를 사용
![[Pasted image 20260202100008.png]]

## 통신흐름 ##

Q. NMS와 보안 장비 모두 연동 설정을 완료했다. 하지만 보안 장비의 데이터가 NMS에 정상적으로 유입되지 않고 있어, 확인해보니 중간에 IPS와 방화벽 장비가 존재했다. 실무자의 입장에서, 무엇을 확인해야 하고 어떻게 해결할 수 있을 것인가?

 내 답변 => 막히는 구간이 방화벽인지 IPS인지 확인하고 해당 장비의 관리자에게 연락을 취한 다음 SNMP를 통해 장비의 정책 등을 수정해서 데이터의 정상적인 통신을 가능하게 만듦

정답 => 
1) **연동 설정 확인**
	- 양 쪽 장비에서 연동 설정이 정상적으로 되었는지 확인
	- 올바른 IP/Port를 기입했는지, Community String 값이 일치하는지 등
2) **IPS 차단 내역 확인**
	- 간혹 SNMP 관련 이벤트로 오탐지될 수 있음
	- 이벤트에 차단 설정이 되어있다면, 상황에 따라 차단을 해제하거나 예외 처리하는 방향으로 대응
3) **방화벽 정책 확인**
	- 방화벽 로그 확인을 통해 통신 흐름을 파악하고 알맞은 방화벽 정책이 적용되어 있는지 확인


### 방화벽 정책의 방향 ###

#### 1) GET 방식 ####
- NMS가 보안 장비에 먼저 데이터 요청
- NMS IP -> 보안 장비 IP / Port : udp_161
	- 요청/응답 방식이니까 응답에 대한 정책도 필요하지 않은지?
	- 필요X, 최근의 방화벽들은 대부분 상태 추적(Stateful inspection) 기반 방화벽으로 요청에 대한 세션 정보를 저장해놓고 있다가 응답에 대한 통신을 자동으로 허용시키기 때문

#### 2) TRAP 방식 ####
- 보안 장비가 일방적으로 NMS에 데이터 전송
- 보안 장비 IP -> NMS IP / Port: udp_162





---
# 3. ZABBIX 소개 #

## 소개 ##

![[Pasted image 20260202094213.png]]

- 서버 및 네트워크의 상태를 실시간으로 모니터링 할 수 있는 NMS


## 장점 ##
- 무료
- 커스터마이징이 자유로움
- 문제 발생 시 알림 기능이 잘 되어있어 메일, 문자 등 발송 가능함
- 타 시스템과 연동하여 사용 가능함 (Grafana, 텔레그램 등)
- 자빅스 사용자들이 올려놓은 모니터링 양식을 사용하여 초기 셋업 없이 사용 가능 


## 단점 ##
- 오픈 소스 특성 상 Zabbix Server 문제 발생 시 지원받기 어려움
- 트리거, 아이템 등 처음에 작업이 필요한 부분이 많고, 적용이 어려운 편이라 초기 셋업이 어려움
	- -> **커스터마이징이 자유로운만큼 관리자의 작업이 많이 필요함**





---
# 4. 실습 #

## 필수 요소 ##

![[Pasted image 20260202100156.png]]


## 도커 소개 ##
### Docker ###
- 컨테이너 기반의 오픈소스 가상화 플랫폼
- 이미지: 컨테이너에서 실행하기 위한 환경 상태들을 여러 파일로 저장해 놓은 상태
- 컨테이너: 원하는 프로세스를 독립적으로 실행하기 위한 기술
	- => 이미지를 설치한 게 컨테이너임. 예를 들어서 게임을 설치할 때 설치 파일이 이미지고, 실행하는 게임이 컨테이너임
- Docker Desktop: Docker를 간편하게 설정하여 PC에서 사용할 수 있음
- Windows Powershell: 명령 프롬프트
- WSL 2: Linux용 Windows 하위 시스템


## 구성 방식 ##
### Docker Compose ###
- 도커 컴포즈는 단일 서버에서 여러 개의 컨테이너를 하나의 서비스로 정의해 컨테이너 묶음으로 관리할 수 있는 작업 환경을 제공하는 관리 도구




...

Zabbix에서 호스트는 각 장비를 뜻함














방화벽: ping, gui - 10.100.4.3:8443, cli - 10.100.4.3:8022
IPS: ping, GUI - 10.200.10.14:4000, cli - 10.200.10.14:4000



아이템

ping
간단검사
key에서 새 항목에서 타겟 아이피만

갱신간격 30s


8443
간단 검사
? key에서 새 항목에서 타겟 아이피만

갱신간격 30s


모니터링 -> 호스트 -> 최근데이터
최근값이 1이면 정상 안 뜨거나 0이면 아쉬움









Q. TCP 4000은 IPS 장비의 GUI 접근 포트이다. TCP_4000 Check 트리거만 발동되어 장애 알람이 울렸다. 관련 아이템 값을 확인해보니 아래 이미지와 같았다. 어떤 상황 일 때 아래처럼 출력될 수 있는가?
![[Pasted image 20260202154542.png]]
내 답변. 같은 호스트(같은 장비)에서 핑은 정상적으로 오고가는데 TCP_4000만 안 됐다는 것은 일단 프로토콜 차이에 의한 것
네트워크 구성에서 중간에 방화벽이 있으니까 관제망 방화벽 or 고객사망 방화벽에서 정책으로 ICMP는 통과시키지만 TCP는 차단시키는 것이 아닐까 싶음

정답
1) **각 망의 방화벽 정책 확인**
	- Zabbix와 헬스 체크 대상 장비인 고객사 IPS 사이에 있는 관제망, 고객사망 방화벽들의 정책 확인
	- 각 방화벽 정책에서 ICMP만 허용되어 있는지, TCP 4000이 없다면 허용 필요
2) **IPS 접근 제어 확인**
	- IPTables 등 IPS 장비의 보안 설정에 의해 Zabbix에서 IPS 장비의 GUI에 접근하지 못할 수 있음
	- 설정 확인 후, Zabbix IP GUI 접근 허용 필요
3) **실제 서비스 장애**
	- IPS 장비가 동작은 하고 있으나, IPS의 기능을 하는 프로세스, 데몬 등이 장애가 난 상태
	- CLI 접근이 가능하다면 어느 정도 대응은 가능하지만, 아니라면 물리적으로 접근하여 대응






OID 마지막에 .0을 넣기(?)

CPU, MEMORY, DISK는 사용률을 제공함. 
cpu, disk는 %OID 로
메모리는 계산식으로





리소스 트랩, 시스템 트랩 -> 시스템 트랩











구글 앱 비밀번호: 테스트
기기용 앱 비밀번호: orri rief knec aiaq





장단점

관심가는 직무
- 현재는 관제

수업을 별점 매기면
- 좋았던 건 8점 이상
- 안 좋았던 건 5점 이하
- 총점으로 6.5점 이상


직업 관련해서 질문할 것
- 이 과정을 모두 수료하고 나서 관제를 지원한다면 **이 과정 없이 신입으로 바로 지원하는 사람들보다 뽑히기 쉬울까요?**
- 관제쪽이 사람 많이 뽑는다고 하던 거 같긴한데 저희 인원이 다 관제로 지원한다면 다 뽑힐정도로 TO가 있을까요?
	- 여름에 뽑는다고 한다면 -> 저번기수
- 예를 들어서 관제같이 사람 많이 뽑는 곳은 TO가 충분할까요? 
- 이 교육과정이 교육을 안 듣는 사람들보다 취업에 있어서 메리트가 있을까요?








트래픽에 대한 리소스 아이템

인터페이스는 장비에 랜선을 꽂는 물리적 포트를 뜻함


포트 하나에 대한 아이템을 생성할 것


snmpwalk -v2c -c String_141 10.100.4.3 1.3.6.1.2.1.2.2.1.8 -> 하위에 있는 OID에 대한 모든 포트의 상태를 출력
snmpwalk -v2c -c String_141 10.100.4.3 1.3.6.1.2.1.2.2.1.8.1 -> 첫 번째 OID에 대한 모든 포트의 상태를 출력
snmpwalk -v2c -c String_141 10.100.4.3 1.3.6.1.2.1.2.2.1.8.20 -> 첫 번째 OID에 대한 모든 포트의 상태를 출력

snmpwalk -v2c -c String_141 10.100.4.3 1.3.6.1.2.1.31.1.1.1.1 -> 하위에 있는 OID에 대한 모든 포트의 이름을 출력
snmpwalk -v2c -c String_141 10.100.4.3 1.3.6.1.2.1.31.1.1.1.1.3 -> 세 번째 OID에 대한 모든 포트의 이름을 출력

snmpwalk -v2c -c String_141 10.100.4.3 1.3.6.1.2.1.31.1.1.1.6 -> 하위에 있는 OID에 대한 모든 포트의 Inbound 누적 트래픽을 출력
snmpwalk -v2c -c String_141 10.100.4.3 1.3.6.1.2.1.31.1.1.1.6.17 -> 17 번째 OID에 대한 모든 포트의 Inbound 누적 트래픽을 출력

snmpwalk -v2c -c String_141 10.100.4.3 1.3.6.1.2.1.31.1.1.1.6.1






첫 번째 OID의 
- 포트 상태 출력: snmpwalk -v2c -c String_141 10.100.4.3 1.3.6.1.2.1.2.2.1.8.1
- 포트 이름 출력: snmpwalk -v2c -c String_141 10.100.4.3 1.3.6.1.2.1.31.1.1.1.1.1
- Inbound 누적 트래픽 확인: snmpwalk -v2c -c String_141 10.100.4.3 1.3.6.1.2.1.31.1.1.1.6.1




인바운드라는 걸 명시


보존하기 전의 처리
첫 번째 옵션 -> byte per second
두 번째 옵션 -> bit per second / 8

인바운드 트래픽을 각자 하나씩 만들 거임



 2개의 아이템을 만들어야함
 

















menti.com 에서 7421 9499로 사이트 접속 및 구글 드라이브 링크 연결
구글 드라이브 링크: https://drive.google.com/drive/folders/1S4lT2j-v4jyHWO2uDW6TCP7e-gSZL0Ng



















































