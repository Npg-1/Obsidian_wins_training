# 침해사고 분석 대응 과정 #


### 침해사고란? ###
정보통신 시스템에 대한 비인가 된 행위 또는 위협의 발생을 의미함


침해사고 대응은 이미 발생한 사고에 대해서 어떻게 들어왔는지 어디에서 들어왔는지 무엇을 추가로 가져갔는지 등을 확인함

침해사고 유형
- 악성코드: 바이러스, 트로이목마, 웜, 백도어, 공격 스크립트 등의 유포
- 비인가 접근: 비 인가된 시스템 접근, 비 인가된 파일 접근, 네트워크 정보 수집 등
- 비인가 사용: 네트워크 서비스의 취약점을 이용하여 서비스 무단 이용
- 서비스 거부: 네트워크 또는 시스템 정보 서비스의 방해
- 오용: 공식적인 목적 이외의 용도로 시스템 및 네트워크의 사용



기밀성 침해(고객정보 및 기밀정보 유출)
- 비인가 접근을 통한 정보 유출
- 내부자에 의한 정보 유출
- 시스템 해킹에 의한 정보 유출
- 보조기억매체 불완전 폐기로 인한 정보 유출
- 도/감청, 스니핑에 의한 정보 유출
- 외부 협력(위탁) 업체를 통한 정보 유출


가용성 침해(서비스 지연/중단)
- 악성코드 감염/공격에 의한 서비스 중단
- 물리적 손상에 의한 서비스 중단
- DoS, DDoS 공격에 의한 서비스 중단


무결성 침해(침입에 의한 정보 변조)
- 기밀성 정보의 의도적인 조작
- 중요 정보 저장 시스템의 해킹
- 인터넷 서비스관련 배너정보의 변경



### 침해사고 발생 원인 ###

#### 인적 요인 ####
- 사용자의 실수, 과실, 무지, 그리고 악의적인 행위 등이 침해사고의 원인이 되는 경우
  예) 취약한 비밀번호 사용, 이메일의 첨부 파일 열람으로 인한 악성코드 감염, 내부자들의 민감 정보 유출

#### 기술적 요인 ####
- 소프트웨어와 하드웨어의 취약점, 시스템 구성 오류, 보안 업데이트 부족 등으로 인해 침해사고의 원인이 되는 경우
  예) 보안 취약점 미 패치, 소프트웨어 버그로 인한 정보 유출, 서버나 네트워크의 잘못된 구성
#### 조직적 요인 ####
- 조직적 요인은 기업이나 기관의 조직 구조, 보안 정책, 경영 방식 등이 침해사고의 원인이 되는 경우
  예) 충분하지 못한 보안 인식 교육, 보안 정책에 의해 접근 제어가 이루어지지 않는 경우




### 침해사고 대응 절차 ###

![[Pasted image 20260127093846.png]]

침해사고 대응에 걸리는 기간은 반나절에서 하루, 3일, 한달 등 대응 기간은 케이스마다 달라짐




## 침해사고 발생 시 주요 분석 관점 ##
1. 시스템에 **어떻게** 들어왔는가
2. 들어와서 **어떤 행위**를 했는가
3. **무엇으로** 어떤 증상을 유발했는가
4. 추가적인 **피해 가능성**이 있는가

### 시스템에 어떻게 들어왔는가 ###
- Viewpoint
	- 내부 관점에서 볼 것인가 외부 관점에서 볼 것인가
	- 내부-외부 관점, 내부-내부 관점에서 어떤 취약점들이 있는가
	- 최근 발생한 보안 위협(보안 이벤트)과 취약 포인트와의 교집합엔 무엇이 있나
	- 침해 관련 증상이 처음 발생한 시점 이전 수일간 발생한 이벤트/로그 중 특이사항이 있는가
	- 해당 서버에서의 사용자 행위가 존재하는가
	- 이전에 침해사고를 당한 적이 있는가, 있었다면 당시에 발견된 취약점은 언제 패치 되었는가

- Example
	- 웹(어플리케이션) 취약점
	- 시스템 취약점
	- 사회공학 기법


키로거: 키보드로 입력한 정보들이 다 기록된 로그 정보




---
## 5. 윈도우 증거 수집 및 분석 ##
침해사고가 발생 시 랜선만 뽑고 컴퓨터를 끄지 않기!!

### 휘발성 데이터 ###
- 컴퓨터 실행 시 메모리 또는 임시 공간에 저장되는 증거, 컴퓨터 종료와 함께 소실
- 휘발성 데이터들의 수명은 그 특성으로 인하여 모두 다르기 때문에 우선순위를 고려하여 수집
- 가장 대표적인 휘발성 데이터는? 메모리

- #### 시스템 정보 ####
	- 시스템 시간
	- 클립보드의 임시 데이터
	- 실행중인 파일 관련 정보
		- 부모/자식 프로세스
		- DLL 등 연관 정보
	- 현재 로그인한 계정 정보
	- 콘솔 명령어
	- 메모리 덤프
- #### 네트워크 정보 ####
	- ARP Table
	- 통신 관련 정보
	- IP, DNS 설정 정보
	- 통신중인 프로그램
	- 네트워크 환경
	- Routing Table
	- 원격 사용자 정보
	- 사용중인 외부 자원
	- 원격 접근 파일


### 비휘발성 데이터 ###
- 컴퓨터 종료 시에도 하드 디스크의 데이터와 같이 삭제되지 않고 존재 하는 디지털 증거
- 휘발성 데이터와는 반대되는 개념으로 상대적으로 안정적인 수집이 가능해서 휘발성 데이터를 먼저 수집하고 그 다음에 수집함

#### 비휘발성 데이터 예시 ####
- 호스트 파일
- Prefetch
- 자동 시작 프로그램
- Jump List
- 이벤트 로그
- MFT
- Registry
- Internet History
- 백신 이벤트
- 휴지통
- ETC

- #### 호스트 파일 ####
	- 경로: \Windows\System32\drivers\etc\hosts
	- hosts는 컴퓨터 내에서 영문으로 된 주소를 숫자로 된 ip주소로 변환해주는 역할을 함
	- 외부 DNS server(도메인 서버)에 주소를 요청하기 이전에 컴퓨터 내부 파일인 hosts를 먼저 탐색하는 것을 악용
	- 최근은 백신에 의해 hosts파일의 변조에 대한 감시 or 차단하고 있음
		- 예를 들어서 도메인 서버상 저장되어 있는 구글의 ip는 172.217.25.110이지만, hosts 파일에서 google.com을 127.0.0.1로 저장해 놓는다면
		  google.com을 입력했을 때 172.217.25.110가 아닌 127.0.0.1(악성 페이지)에 해당하는 홈페이지에 접속이 되는 원리

- #### 프리패치(Prefetch) ####
	- 경로: %SystemRoot%\Prefetch or \Windows\Prefetch
	- Prefetching은 윈도우에서 부팅할 때나 응용프로그램을 시작할 때 성능 향상을 위해 구현된 기능
	- 생성된 Prefetch 파일은 응용프로그램을 재실행 할 때 속도 향상을 위해 사용
	- 최대 128개 파일 유지, 새로운 응용프로그램이 실행되면 가장 오랫동안 사용하지 않은 응용프로그램의 Prefetch 파일 (.pf)을 삭제
		- -> 침해사고가 터지면 빨리 대응해야지 prefetch도 보존될 수 있어서 신고를 빨리 해야함

- #### 시작프로그램(Startup) 폴더 ####
	- 모든 경로: C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup
	- 개인 경로: C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup
	- 시작 프로그램 목록에 등록된 서비스는 시스템이 시작될 때마다 OS에 의해 자동으로 시작됨

- #### Jump List ####
	- 모든 사용자 경로: %UserProfile%\AppData\Roaming\Microsoft\Winodws\Recent
	- 응용프로그램 별로 그룹화 하고 최근 실행한 파일에 대한 링크를 관리하는 파일
	- 작업 표시줄에 표시되는 아이콘을 우클릭 했을 때 최근 항목이나 작업 항목 등 이전에 자주 여는 파일 목록







수요일의 시험(?)은 오픈북(인터넷 사용은 안 됨)으로 진행됨. 시간도 넉넉함




1. CVE-2021-44228을 이용하여 공격한 패킷을 입수함 (log4j.pcap) 
   관련하여 Log4j의 취약점을 이용한 공격자 IP를 찾기 -> 172.29.200.200

제미나이한테 물어보니까 필터창에 fram contains "jndi"를 해보라고 해서 해봤음, 그러니까 이런 거 떠서 맨 뒤에 jndi 있는 거 확인하고 source인 172.29.200.200가 맞다고함
![[Pasted image 20260127155927.png]]

CVE-2021-44228 는 로그 메시지 안에 ${jndi:protocol://server/path} 와 같은 특수 구문이 있으면 이를 해석하고 실행하는 'Lookup' 기능이 있음


로깅 라이브러리: 소프트웨어가 실행되는 동안 발생하는 모든 로그를 자동으로, 체계적으로 남길 수 있게 도와주는 도구들의 모음

2. cat /etc/passwd



3. 172.29.123.4






















같은 마이크의 같은 볼륨이라도 A는 뭔가 그다지 듣기도 싫고 귀도 아픈 느낌인데 B는 같은 마이크지만 그다지 싫지 않음
ㅈㄴ 차별적인 거 같기도하네요



























