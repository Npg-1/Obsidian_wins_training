# 1. 리눅스 시스템 개요 #

## 리눅스 시스템 ##

#### > 리눅스란 윈도우나 MacOS 같은 컴퓨터 운영체제의 일종 ####
- 주로 오픈소스 소프트웨어로 서버를 구축하기 위해서 사용
- 다양한 리눅스 배포판이 존재
	  예: 데비안(Debian), 레드햇(RedHat), 슬랙웨어(Slackware)



## 윈도우/리눅스 시스템의 차이점 ##

#### > 다른 파일 시스템 구조 ####
- 파일 삭제 시 주요 메타데이터가 와이핑(ext3, ext4)
- 파일의 생성시간이 존재하지 않음 (ext4 이전)
- LVM 등 논리적인 볼륨을 구성 가능
	- \* 와이핑: 일반적인 삭제와는 달리 와이핑을 하면 복구가 불가능함. C의 포인터를 비유로 설명하자면 일반 삭제는 포인터가 가리키는 공간은 그대로 남겨둬서 나중에 주소만 알면 다시 가리킬 수 있음(복구 가능). 하지만 와이핑은 포인터가 가리키는 공간을 할당 해제를 해서 아예 쓰레기값으로 채워둬서 복구가 안 됨
	- \* ext(Extended File System): 확장 파일 시스템의 약자로 윈도우의 FAT32, NTFS와는 달리 리눅스 운영체제에서 가장 표준적으로 사용하는 파일 시스템 시리즈임
	- \* LVM: 여러 개의 하드디스크를 합쳐서 한 개의 파일시스템으로 사용하거나 합쳐진 것을 다시 여러 개로 나누어 파일 시스템 구성이 가능하게 하는 기술

#### > 레지스트리가 존재하지 않음 ####
- 운영체제/어플리케이션의 실시간 정보 관리를 위한 특별한 구조가 미존재
- 시스템 정보를 산재된 자료로부터 수집하여야함

#### > 텍스트 기반의 파일 데이터 ####
- 자체 내장 명령어를 조합하여 문자열 검색/필터 만으로 많은 작업 수행 가능



## 파일 시스템과 파티션 ##

#### > 파일 시스템 ####
- 파일을 저장하기 위한 운영체제의 논리적인 구조
- 파일과 그 안에 든 자료를 저장하고 찾기 쉽도록 유지, 관리하는 방법
- 유저 영역이 아닌 커널 영역에서 동작함

#### > 파티션 ####
- 물리적인 디스크를 논리적인 저장영역으로 구별한 것
- primary 파티션: 물리적인 디스크에 독립적으로 존재하며 파일시스템을 생성, 운영체제가 직접 사용 가능
  각 물리적인 디스크마다 4개까지 생성 가능
- Extended 파티션: 디스크 마다 1개까지 생성 가능, 직접 사용 불가능하고 Logical 파티션으로 분할 가능
  (Logical 파티션을 만들기 위한 공간)
- Logical 파티션: Extended 파티션 내에 만들어지며 사용은 primary 파티션과 동일함



## 디스크 장치 파일 ##

아래는 저장장치(HDD, SSD)를 메인보드에 연결하는 인터페이스 규격들임
#### > IDE(Itergrated Drive Electronics) ####
- 가장 오래된 규격으로 40핀으로 구성된 직사각형 모양의 규격임

#### > SATA(Intergrated Drive Electronics) ####
- IDE의 후계자로 현재 일반 가정용 PC/노트북에서 가장 많이, 대중적으로 쓰이는 규격임

#### > SCSI(Small Computer System Interface) ####
- 서버나 워크스테이션 등에서 쓰이는 고속의 규격

#### > SAS ####
- 기업용/서버용 규격으로 매우 높은 안정성과 전송속도를 가짐



## 리눅스 파일 시스템 ##

#### EXT 파일시스템 ####
- 각각의 운영체제들은 파일들을 관리하기 위한 파일 시스템을 가지고 있음
- 예: 윈도우는 NTFS, 맥 OS는 APFS, 리눅스의 경우 EXT 파일 시스템을 사용 

#### EXT2 ####
- 리눅스 운영체제에서 사용할 수 있는 파일 시스템으로, inode 하나 당 하나의 파일을 저장
- 파일을 저장할 때 Block Mapping 방식을 사용
	- \* Block Mapping: 하나의 inode가 여러개의 블록을 가리키도록 하여 많은 파일들을 효율적으로 저장

#### EXT3 ####
- ext2와 거의 유사하지만 저널링(Journaling) 기능이 추가됨
	- \* 파일 시스템의 변경 사항을 추적하기 위해서 만들어진 기능으로, 갑작스러운 장애나 불상사 같은 경우 파일 손상을 최소화 시켜주고 삭제된 파일을 복구하는데 사용함

#### EXT4 ####
- extends 트리를 이용하여 파일을 관리함
- MBR와 Block Group (그냥 Group으로 표현하기도 함)으로 나누어짐
	- \* 



## 리눅스 디렉토리 구조 ##

| 디렉토리                               | 설명                                                  |
| :--------------------------------- | :-------------------------------------------------- |
| / (Root)                           | 모든 파일과 디렉토리는 "/"에서 시작, 루트만이 쓰기 권한을 가짐               |
| /bin (User binaries)               | 모든 사용자가 사용하는 명령어(예: ps, ls, grep 등) 저장              |
| /sbin (System Binaries)            | 관리자가 시스템 유지를 위해 사용하는 명령어 (예: reboot, ifconfig 등) 저장 |
| /etc (Configuration Files)         | 모든 프로그램에서 필요로 하는 설정 파일                              |
| /dev (Device Files)                | 터미널 디바이스, USB 등 시스템에 붙이는 장치 파일들을 저장                 |
| /proc (Process Information)        | 프로세스, 시스템 자원 등을 가상의 파일시스템으로 저장 (pid, uptime 등)      |
| /var (Variable Files)              | 각종 로그 파일, 메일 임시 저장                                  |
| /tmp (Temporary Files)             | 임시 파일 공간(위 공간과는 다르게 관리자 권한이 따로 필요 없음)               |
| /usr (User Programs)               | 프로그램 설치 공간으로 관련 명령어, 라이브러리 위치                       |
| /home (Home Directories)           | 시스템 계정 사용자들의 홈 디렉토리 (생성한 계정마다 home 아래에 여러개 있음)      |
| /boot (Boot Loader Files)          | 커널을 포함하는 부팅 시 필요한 파일 저장 위치                          |
| /lib (System Libraries)            | 라이브러리가 저장되는 공간으로 대부분 공유 라이브러리 위치                    |
| /opt (Optional add-on Application) | 개별 판매자의 add-on 어플리케이션을 포함                           |
| /mnt (Mount Directory)             | 외부 장치 mount 공간                                      |



## 리눅스 서비스 운영 방식 ##

#### standalone 운영 방식 ####
- 서비스가 메모리에 항상 상주하는 방식
- 데몬 프로세스들이 독립적으로 수행
- 자꾸 실행되는 데몬 프로세스에 적용되는 방식
- 서비스 요청이 많을 때 사용하기 적합 (예: Web, Mail)
- '/etc/rc.d/init.d' 경로에 위치





#### >런레벨(Runlevel) 설정 방법 ####
- CentOS 6 이전의 경우
- \# vi /etc/inittab


#### >ckconfig ####
- 리눅스 시스템이 부팅될 때 실행될 서비스를 자동으로 실행되도록 설정하는 유틸리티
- 서버 부팅 시 프로그램 리스트와 런레벨 별 실행 여부 등을 확인하거나 설정 가능


#### > systemctl ####
- 기존에는 /etc/rc.d/init.d 디렉토리에 서비스 관련 파일 두고 'chkconfig', 'service' 명령어로 제어함
- CentOS7 이후 부터 서비스들 대부분 Unit으로 분리, '서비스명.service' 파일명, 'systemctl' 명령어로 제어
- '/usr/lib/systemd/system' 디렉토리 또는 'user/lib/system/user' 디렉토리 아래에 확장자 '.service' 파일로 존재함
- '.service' 파일은 크게 \[Unit], \[Service], \[Install] 부분으로 존재함



## 리눅스 정보 수집 순서 ##
- memory dump - 시스템 정보를 통한 분석



## 수집 순서 ##
- #### 휘발성 증거 수집 후 비휘발성 증거 수집 ####
	- Memory -> Storage Dump
	- 대부분의 휘발성 정보는 Merory Dump에서 획득 가능
	- 실제 분석은 획득한 Data(Memory/Storage Dump 등) 뿐만 아니라 Live 시스템 점검과 병행하여 진행하는 것이 좋음



## 휘발성 수집 순서 ##
- #### 시스템 정보 ####
	- 시스템 시간
	- 임시 데이터
	- 실행중인 파일 관련 정보
		- 부모/자식 프로세스
		- 연관 정보
	- 현재 로그인한 계정 정보
	- 콘솔 명령어
	- 메모리
	- 캐시
	- 로드 된 모듈 

- #### 네트워크 정보 ####
	- ARP 테이블
	- 통신 관련 정보
	- IP, DNS 설정 정보
	- 통신중인 프로그램
	- 네트워크 환경
	- 라우팅 테이블
	- 원격 사용자 정보
	- 사용중인 외부 자원
	- 원격 접근 파일



## 메모리 수집 파일 분석 ##
- #### > 메모리 분석의 장점 ####
	- 암호화/패킹된 실행 파일의 경우 메모리상에서는 복호화되어 존재

- #### > Volatility ####
	- 메모리 분석용 open-source tool로 windows와 linux를 모두 지원
	- 기본 문법은 아래와 같은 (linux verison 기준)



## 디스크 덤프 ##
- 리눅스 시스템의 정보수집 과정 중 외장 하드, USB에 디스크드라이브를 수집하는 방법

- #### > df(disk free) 명령어 ####
	- 리눅스 시스템 전체(마운트 된) 디스크 여유 공간 확인 명령어
	- 파일시스템, 디스크 크기 사용량, 여유 공간, 사용률 마운트 지점 확인 가능
		- 옵션
		- -a: 모든 파일 시스템 출력
		- -h: 읽기 쉬운 형태의 단위로 출력, 기본 KB 단위A
		- -t: 보여주는 목록을 파일시스템의 타입으로 제한
		- -l: 출력하는 목록을 로컬 파일 시스템으로 제한 

- #### > du(disk usage) 명령어 ####
	- 특정 디렉토리의 디스크 크기를 확인하는 명령어
	- 옵션이 없는 경우, 현재 경로의 모든 디렉토리 크기를 MB 단위로 출력함
		- 옵션
		- -h: 크기 단위 표시 추가
		- -a: 하위 디렉토리의 각각 용량 까지 표시
		- -s: 하위 디렉토리 표시 없이 전체 용량 표시



## 마운트(Mount) ##
- 리눅스에서 하드디스크의 파티션, CD/DVD, USB 등을 사용하기 위해 특정한 위치에 연결 필요
- 물리적인 장치를 특정한 위치(대부분 디렉토리)에 연결시켜 주는 과정을 마운트(Mount)라고 함







---
# 4. 침해사고 증거수집 및 분석 #

## 리눅스 기본 명령어 ##

#### > uptime 명령어 ####
- 시스템 시작 시간, 현재 사용자 수, 평균 부하량 등의 정보 확인 가능

#### > ip link 명령어 ####
- 시스템 시작 시간, 현재 사용자 수, 평균 부하량 등의 정보 확인 가능

#### > printenv 명령어 ####
- 시스템 시작 시간, 현재 사용자 수, 평균 부하량 등의 정보 확인 가능

#### > version 명령어 ####
- \# cat /etc/os-release
- \# cat /proc/version

#### > Service 명령어 ####
- 리눅스 시스템 서비스를 조작하기 위해 서비스 명령어 사용
	- start: 중지된 서비스 시작
	- stop: 실행되는 서비스 중지
	- restart: 멈춘 후 실행 서비스 시작 또는 중지된 서비스 시작



## 네트워크 정보 ##
#### > Network Connection  ####
- 연결(established)되고 수신 중(listening)인 네트워크 소켓 접속 표시
- 원격지 호스트와 통신하고 있는 대상 시스템의 프로세스 표시 (PID/Program name)
- 다른 출발지와 관련된 행동과 로그를 검색하기 위해 사용될 수 있는 원격지 IP 제공
	- \# netstat -antup- 예: command\[option] > \[output file]

#### > ARP Cache Table  ####
- 문자열

#### > Routing Table  ####
- 패킷이 목적지, 목적지까지의 거리와 가는 방법 등을 명시하고 있는 테이블
- 공격자들은 라우팅 테이블을 변경해 네트워크 트래픽이 잘못된 곳으로 가거나 중단되도록 함
- 호스트와 원격 서버 사이에 전용 VPN 접속을 생성해 탈취한 데이터를 암호화된 터널을 통해 전송함

#### > NIC Promiscuous  ####
- NIC가 sniffing mode로 동작하는지 확인
- NIC는 자신에게만 오는 패킷만 수신하지만 Promiscuous mode(sniffing mode) 시 다른 NIC로 가는 패킷도 수신함
  다른 곳으로 가는 패킷까지 긴빠이를 한다고??
- \# ifconfig -a


## Open Files & Loaded Modules 정보 ##
#### > 명령어의 수행 결과를 Redirection하여 Text로 저장  ####
- 문자열


## 작업 스케쥴러 ##
- 특정 프로세스나 네트워크 커넥션 정보를 관리자가 쉽게 눈치채지 못하게 하기 위해 스케쥴을 걸어서 특정 명령을 실행함 

#### > at  ####
- 문자열

#### > Crontab  ####
- 현재 로그인한 사용자의 스케쥴 표시
- (-u 옵션)으로 다른 계정의 스케쥴을 볼 수 있음


## 임시 & 숨긴 파일 확인 ##
- 악의적인 목적에 의해 업로드 되거나 사용되었던 file 흔적 확인 및 채증
- 누구나 파일 생성이 가능한 sticky bit 권한의 Temporary 디렉토리 (여기에 문제가 있는 것들을 좀 확인함)
	- /tmp
	- /tar/tmp
	- /dev/shm
- 웹을 통해 공격할 경우 웹 권한 (보통 nobody, apache, www 등)을 갖기 때문에
  다른 디렉토리에 파일을 생성할 수 없지만 Sticky bit가 설정된 디렉토리에는 파일 생성 가능


## MAC TIME 분석 ##
- 침해사고 분석 시 가장 중요한 부분은 시간으로 MAC Time에 대한 이해가 필요
- 공격자가 공격한 시간과 파일의 마지막 접근,수정,변경 시간 등이 일치하다면 무엇을 건드렸는지 확인할 수 있음
- 리눅스 할 때는 반드시 stat 을 쳐야함

- #### > atime (acess time)  ####
	- 파일접근 시간
	- write, read, access 할 때 마다 업데이터 되며, CLI, system process에 의해 수행 될 수 있음

- #### > mtime (modify time)  ####
	- 파일내용 수정 시간
	- 파일의 권한 변경으로는 update되지 않음. 파일 내용 변경 추적에 용이함

- #### > ctime (change time)  ####
	- 파일속성 변경 시간
	- 소유권, 엑세스 권한 또는 파일 수정 시 업데이트
	- 파일의 상태 정보의 최종 수정 시간, 아이 노드의 데이터가 변경 될 때마다 update


## 시간 기반의 검색 ##
- #### > ls  ####
	- 문자열
		- -tl: mtime(생성, 내용변경 시간) 조회
		- -ul: atime
		- -cl: ctime

- #### > find  ####
	- ndays 옵션으로 number를 기준으로 수정된 파일을 검색 할 수 있음


## 프로세스 정보 ##
- #### > 명령어의 수행 결과를 Redirection하여 Text로 저장  ####
	- 예:






## 침해사고조사/시스템 분석 시 확인 파일 ##
#### > 계정 정보 파일  ####
- /etc/passwd, /etc/shadow, /etc/group
- 의도하지 않은, 또는 알 수 없는 user의 생성
- root 계정 이외에 uid 또는 gid가 0인 계정

#### > 슈퍼 데몬(Super Daemon)  ####
- inetd 또는 xinetd라 함, 데몬을 관리하는 데몬
- inetd 경우 /etc/inet.conf, xinetd 경우 /etc/xinetd.d에 각 서비스에 대한 설정 파일 존재

#### > .rhosts, /etc/hosts.equiv  ####
- hostname이나 username에 '+'가 있을 경우 any를 뜻하고 "+ +"는 누구든 인증 절차 없이 접근할 수 있다는 것을 의미


## 파일 해시 값 추출 ##
#### > 파일 해시 값 추출을 해야하는 이유  ####
- 임의의 데이터로부터 일종의 "전자 지문"을 만들어 내는 방법








## Log 분석 ##
#### > Authentication LOG  ####
- Telnet, FTP, SSH 등 인증 과정을 거치는 모든 행위에 대한 로그를 저장
- 보통 secure라는 파일명, 시스템에 따라 auth.log라는 파일명으로 저장

#### > wtmp/btmp log  ####
- wtmp는 last(로그인 기록), btmp는 lastb(로그인 실패 기록)
- 바이너리 형태로 저장되며 텍스트 에디터로는 확인이 불가, last 명령을 통해서 확인 가능

#### > lastlog log  ####
- 각 계정(/etc/passwd에 등록된 계정)의 마지막 로그인 기록
- 바이너리 형태로 저장되며 텍스트 에디터로는 확인이 불가, lastlog 명령을 통해서 확인 가능


...

#### > top  ####
- 시스템의 상태(CPU, MEM, Process)를 전반적으로 가장 빠르게 파악 가능
- interval 간격(기본 3초)으로 화면을 갱신하며 정보를 보여줌



...


## 의심 파일 분석 ##
#### > Hidden files and directories (Cont.)  ####
- 파일에 숨김 속성을 설정하기 보다는 ".. "과 같은 형태로 디렉토리에 숨김 속성을 설정









vi 명령어들

입력		설명
dd, yy, p, x, gg, G

/abc		문서 내 abc 단어 검색 (문서작업의 Ctrl + f 와 유사함)
n		다음 일치 단어 검색 표시
N		이전 일치 단어 검색 표시
:se nu		현재 문서 행 번호 표시
u		마지막 행동 취소(Ctrl + z와 유사함)
Ctrl+R		마지막 행동 재실행 (Ctrl + y와 유사함)
:!명령어	리눅스 명령어 수행
:%s/ABC/abc	문서 내 ABC를 abc로 변환 (Ctrl + h와 유사함)
view		읽기 전용 모드로 문서 열람


! 는 강제
q 는 vi 종료
w는 저장
:wq 는 저장 후 종료
:q! 강제 종료
:wq! 저장 후 강제 종료




















